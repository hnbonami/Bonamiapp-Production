#!/bin/bash

# Deployment Script voor Performance Pulse
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo -e "${GREEN}ğŸš€ Deployment gestart...${NC}"

# Configuratie
GIT_DIR="/home/c9kxrmhxa_ssh/git/performancepulse.git"
TARGET="/webroots/b524bfb2"
BRANCH="main"

echo -e "${GREEN}ğŸ“¦ Code uitchecken naar: $TARGET${NC}"

# Checkout code
git --work-tree=$TARGET --git-dir=$GIT_DIR checkout -f $BRANCH

cd $TARGET

echo -e "${GREEN}âš™ï¸  Laravel optimalisaties...${NC}"

# Composer (als beschikbaar)
if command -v composer &> /dev/null; then
    echo "ğŸ“¦ Composer install..."
    composer install --no-dev --optimize-autoloader --no-interaction
fi

# Laravel cache
if [ -f "artisan" ]; then
    php artisan config:cache
    php artisan route:cache
    php artisan view:cache
    echo -e "${GREEN}âœ… Cache gegenereerd${NC}"
fi

# Permissies
chmod -R 775 storage bootstrap/cache 2>/dev/null || chmod -R 777 storage bootstrap/cache

echo -e "${GREEN}âœ… DEPLOYMENT COMPLEET!${NC}"
echo -e "${GREEN}ğŸŒ https://performancepulse.be${NC}"
